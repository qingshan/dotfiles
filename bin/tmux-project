#!/usr/bin/env bash

function _goto_project_root {
  cd $(git rev-parse --show-toplevel)
}

function _check_toolchain {
  if [ -f Cargo.toml ] ; then
    _TOOLCHAIN="cargo"
  elif [ -f go.mod ] ; then
    _TOOLCHAIN="go"
  fi
}

_goto_project_root
_check_toolchain

if [ -z "$_TOOLCHAIN" ]; then
  exit 0
fi

if [[ $# -eq 0 ]]; then
  exit 0
fi

cmd="$1"
shift
case $cmd in
  all)
    ${_TOOLCHAIN}-project $cmd $@ | fzf --no-sort --prompt ' ' --pointer='➤ ' --marker='➤'
    ;;
  *)
    ${_TOOLCHAIN}-project $cmd $@ | fzf --with-nth=3,4 --no-sort --prompt ' ' --pointer='➤ ' --marker='➤'
    ;;
esac
